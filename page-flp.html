<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Responsive 3D Flipbook with Bidirectional Drag</title>
        <link rel="stylesheet" href="style/style.css" />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Georgia", serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                perspective: 1200px;
                overflow: hidden;
                padding: 20px;
            }

            .flipbook-container {
                position: relative;
                width: min(700px, 90vw);
                height: min(500px, 70vh);
                transform-style: preserve-3d;
            }

            /* Mobile responsive adjustments */
            @media (max-width: 768px) {
                .flipbook-container {
                    width: min(350px, 90vw);
                    height: min(500px, 80vh);
                    overflow: hidden;
                }
            }

            .page {
                position: absolute;
                width: 50%;
                height: 100%;
                background: white;
                border: 2px solid #333;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
                transform-style: preserve-3d;
                transform-origin: left center;
                transition: transform 0.6s ease-in-out;
                cursor: grab;
                border-radius: 5px;
                user-select: none;
                right: 0;
            }

            /* Mobile: Full width pages */
            @media (max-width: 768px) {
                .page {
                    width: 100%;
                    right: auto;
                    left: 0;
                    transform-origin: center center;
                }
            }

            .page:active {
                cursor: grabbing;
            }

            .page-front,
            .page-back {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 3px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }

            .page-back {
                transform: rotateY(180deg);
            }

            /* Desktop flip behavior */
            @media (min-width: 769px) {
                .page.flipped {
                    transform: rotateY(-180deg);
                }

                .page.dragging {
                    transition: none;
                }

                .page:nth-child(1) {
                    z-index: 6;
                }
                .page:nth-child(2) {
                    z-index: 5;
                }
                .page:nth-child(3) {
                    z-index: 4;
                }
                .page:nth-child(4) {
                    z-index: 3;
                }
                .page:nth-child(5) {
                    z-index: 2;
                }
            }

            /* Mobile positioning and behavior */
            @media (max-width: 768px) {
                .page {
                    z-index: 1;
                    transition: transform 0.5s ease-in-out;
                }

                .page.mobile-active {
                    z-index: 10;
                    transform: translateX(0);
                }

                .page.mobile-left {
                    transform: translateX(-100%);
                    z-index: 5;
                }

                .page.mobile-right {
                    transform: translateX(100%);
                    z-index: 5;
                }

                .page.mobile-flip-front {
                    transform: rotateY(0deg);
                }

                .page.mobile-flip-back {
                    transform: rotateY(-180deg);
                }
            }

            .placeholder-content {
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: white;
                text-align: center;
                line-height: 0;
            }
            .placeholder-content img {
                pointer-events: none;
                margin-bottom: -1px;
            }

            .placeholder-icon {
                font-size: clamp(2em, 6vw, 4em);
                margin-bottom: 15px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }

            .page-title {
                font-size: clamp(1.2em, 3vw, 2em);
                font-weight: bold;
                margin-bottom: 10px;
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            }

            .placeholder-text {
                font-size: clamp(0.9em, 2.5vw, 1.2em);
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            }

            .page-number {
                position: absolute;
                bottom: 15px;
                right: 15px;
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 5px 10px;
                border-radius: 15px;
                font-size: 0.9em;
                font-weight: bold;
            }

            .cover-page {
                background: linear-gradient(135deg, #ff6b6b, #feca57);
            }

            .back-cover {
                background: linear-gradient(135deg, #2d3436, #636e72);
            }

            .controls {
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 10px;
                z-index: 1000;
            }

            .btn {
                padding: 12px 24px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                border: none;
                border-radius: 25px;
                cursor: pointer;
                font-size: clamp(0.8em, 2vw, 1em);
                transition: all 0.3s;
                backdrop-filter: blur(10px);
            }

            @media (max-width: 480px) {
                .btn {
                    padding: 10px 16px;
                    font-size: 0.8em;
                }
            }

            .btn:hover:not(:disabled) {
                background: rgba(0, 0, 0, 0.9);
                transform: translateY(-2px);
            }

            .btn:disabled {
                background: rgba(0, 0, 0, 0.3);
                cursor: not-allowed;
                transform: none;
            }

            .instructions {
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: clamp(0.7em, 2vw, 0.9em);
                z-index: 1000;
                backdrop-filter: blur(10px);
                text-align: center;
                max-width: 90vw;
            }

            .mobile-page-indicator {
                position: fixed;
                top: 70px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 5px 15px;
                border-radius: 15px;
                font-size: 0.8em;
                z-index: 1000;
                display: none;
            }

            @media (max-width: 768px) {
                .mobile-page-indicator {
                    display: block;
                }

                .instructions {
                    top: 10px;
                    padding: 8px 16px;
                }
            }
        </style>
    </head>
    <body>
        <div class="instructions">
            <span class="desktop-text"
                >Drag left/right or click pages to flip â€¢ Use controls
                below</span
            >
            <span class="mobile-text"
                >Tap to flip pages or use controls below</span
            >
        </div>

        <div class="mobile-page-indicator">
            Page <span id="currentPageNum">1</span> of
            <span id="totalPageNum">8</span>
        </div>

        <div class="flipbook-container">
            <!-- Cover Page -->
            <div class="page mobile-active" data-page="0">
                <div class="page-front cover-page">
                    <div class="placeholder-content">
                        <img src="assets/book-image.png" alt="" />
                    </div>
                </div>
                <div class="page-back">
                    <div class="placeholder-content">
                        <img src="assets/book-page-1.jpg" alt="" />
                    </div>
                </div>
            </div>

            <!-- Page 1 -->
            <div class="page mobile-right" data-page="1">
                <div class="page-front">
                    <div class="placeholder-content">
                        <img src="assets/book-page-2.jpg" alt="" />
                    </div>
                </div>
                <div class="page-back">
                    <div class="placeholder-content">
                        <img src="assets/book-page-3.jpg" alt="" />
                    </div>
                </div>
            </div>

            <!-- Page 2 -->
            <div class="page mobile-right" data-page="2">
                <div class="page-front">
                    <div class="placeholder-content">
                        <img src="assets/book-page-4.jpg" alt="" />
                    </div>
                </div>
                <div class="page-back">
                    <div class="placeholder-content">
                        <img src="assets/book-page-3.jpg" alt="" />
                    </div>
                </div>
            </div>

            <!-- Page 3 -->
            <div class="page mobile-right" data-page="3">
                <div class="page-front">
                    <div class="placeholder-content">
                        <img src="assets/book-page-4.jpg" alt="" />
                    </div>
                </div>
                <div class="page-back">
                    <div class="placeholder-content">
                        <img src="assets/book-page-3.jpg" alt="" />
                    </div>
                </div>
            </div>

            <!-- Back Cover -->
            <div class="page mobile-right" data-page="4">
                <div class="page-front">
                    <div class="placeholder-content">
                        <img src="assets/book-page-4.jpg" alt="" />
                    </div>
                </div>
                <div class="page-back back-cover">
                    <div class="placeholder-content" style="background: none">
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" id="prevBtn">Previous</button>
            <button class="btn" id="nextBtn">Next</button>
            <button class="btn" id="resetBtn">Reset</button>
        </div>
        <script>
            class ResponsiveFlipbook {
                constructor() {
                    this.pages = document.querySelectorAll(".page");
                    this.totalPages = this.pages.length;

                    this.isDragging = false;
                    this.dragStartX = 0;
                    this.dragThreshold = 50;

                    // Only phones are mobile, tablets and desktop use dragging
                    this.isMobile = window.innerWidth <= 480;

                    // Detect if device supports touch
                    this.isTouchDevice =
                        "ontouchstart" in window ||
                        navigator.maxTouchPoints > 0;

                    // Mobile state
                    this.mobileCurrentPageIndex = 0;
                    this.mobileShowingBack = false;
                    this.totalMobileViews = this.totalPages * 2; // front and back of each page

                    // Desktop state
                    this.currentPage = 0;

                    this.prevBtn = document.getElementById("prevBtn");
                    this.nextBtn = document.getElementById("nextBtn");
                    this.resetBtn = document.getElementById("resetBtn");

                    // Bind handlers for removeEventListener use
                    this.boundOnDrag = (e) => this.drag(e);
                    this.boundEndDrag = () => this.endDrag();

                    // === NEW: Bind touch move and end handlers for desktop dragging ===
                    this.boundTouchMove = (e) => {
                        if (this.currentDragPage !== undefined) {
                            e.preventDefault(); // Prevent scrolling while dragging
                            this.drag(e.touches[0]);
                        }
                    };
                    this.boundTouchEnd = this.boundEndDrag;
                    // ===================================================================

                    // Store desktop page click handlers for removal
                    this.desktopClickHandlers = [];

                    this.init();
                    this.updateResponsiveDisplay();

                    window.addEventListener("resize", () =>
                        this.handleResize()
                    );
                }

                handleResize() {
                    const wasMobile = this.isMobile;
                    // Mobile breakpoint includes tablets
                    this.isMobile = window.innerWidth <= 768;

                    if (wasMobile !== this.isMobile) {
                        this.reset();
                        this.updateResponsiveDisplay();
                    }
                }

                updateResponsiveDisplay() {
                    const desktopText = document.querySelector(".desktop-text");
                    const mobileText = document.querySelector(".mobile-text");

                    if (this.isMobile) {
                        if (desktopText) desktopText.style.display = "none";
                        if (mobileText) mobileText.style.display = "inline";
                        this.setupMobileView();
                    } else {
                        if (desktopText) desktopText.style.display = "inline";
                        if (mobileText) mobileText.style.display = "none";
                        this.setupDesktopView();
                        this.removeMobileEvents(); // remove mobile events if any
                    }
                }

                init() {
                    this.setupEventListeners();
                    this.updateControls();
                }

                setupMobileView() {
                    // Reset all pages
                    this.pages.forEach((page, index) => {
                        page.classList.remove(
                            "mobile-active",
                            "mobile-left",
                            "mobile-right",
                            "flipped",
                            "mobile-flip-front",
                            "mobile-flip-back"
                        );

                        if (index === 0) {
                            page.classList.add(
                                "mobile-active",
                                "mobile-flip-front"
                            );
                        } else {
                            page.classList.add("mobile-right");
                        }
                    });

                    this.mobileCurrentPageIndex = 0;
                    this.mobileShowingBack = false;
                    this.updateMobileIndicator();

                    this.removeDesktopEvents(); // remove desktop events if any
                    this.setupMobileEvents(); // add mobile events
                }

                setupDesktopView() {
                    // Reset all pages for desktop
                    this.pages.forEach((page, index) => {
                        page.classList.remove(
                            "mobile-active",
                            "mobile-left",
                            "mobile-right",
                            "mobile-flip-front",
                            "mobile-flip-back"
                        );
                        page.style.transform = "";
                        page.style.zIndex = "";
                    });

                    this.currentPage = 0;
                    this.updateZIndices();

                    this.setupDesktopEvents();
                }

                updateMobileIndicator() {
                    const currentPageNum =
                        document.getElementById("currentPageNum");
                    const totalPageNum =
                        document.getElementById("totalPageNum");

                    if (currentPageNum && totalPageNum) {
                        const visualPage =
                            this.mobileCurrentPageIndex * 2 +
                            (this.mobileShowingBack ? 2 : 1);
                        currentPageNum.textContent = visualPage;
                        totalPageNum.textContent = this.totalMobileViews;
                    }
                }

                setupEventListeners() {
                    // Mobile and desktop page click handled separately now

                    // Control buttons
                    this.prevBtn.addEventListener("click", () =>
                        this.previousPage()
                    );
                    this.nextBtn.addEventListener("click", () =>
                        this.nextPage()
                    );
                    this.resetBtn.addEventListener("click", () => this.reset());

                    // Prevent context menu on pages
                    document.addEventListener("contextmenu", (e) => {
                        if (e.target.closest(".page")) {
                            e.preventDefault();
                        }
                    });
                }

                setupDesktopEvents() {
                    this.removeDesktopEvents();

                    this.pages.forEach((page, index) => {
                        page.style.cursor = "grab";

                        // Mouse events for desktop
                        const mouseDownHandler = (e) =>
                            this.startDrag(e, index);
                        page.addEventListener("mousedown", mouseDownHandler);

                        if (this.isTouchDevice) {
                            const touchStartHandler = (e) => {
                                e.preventDefault(); // Prevent scrolling while dragging
                                this.startDrag(e.touches[0], index);
                            };
                            page.addEventListener(
                                "touchstart",
                                touchStartHandler,
                                {
                                    passive: false,
                                }
                            );

                            page._mouseDownHandler = mouseDownHandler;
                            page._touchStartHandler = touchStartHandler;
                        } else {
                            page._mouseDownHandler = mouseDownHandler;
                        }
                    });

                    document.addEventListener("mousemove", this.boundOnDrag);
                    document.addEventListener("mouseup", this.boundEndDrag);

                    if (this.isTouchDevice) {
                        // Bind touchmove handler to a named function so we can remove it later
                        this.boundTouchMoveHandler = (e) => {
                            if (this.isDragging) {
                                e.preventDefault(); // Prevent page scrolling while dragging
                                this.drag(e.touches[0]);
                            }
                        };

                        document.addEventListener(
                            "touchmove",
                            this.boundTouchMoveHandler,
                            {
                                passive: false,
                            }
                        );
                        document.addEventListener(
                            "touchend",
                            this.boundEndDrag
                        );
                    }

                    this.setupDesktopPageClicks();
                }

                removeDesktopEvents() {
                    this.pages.forEach((page, index) => {
                        page.style.cursor = "";

                        if (page._mouseDownHandler) {
                            page.removeEventListener(
                                "mousedown",
                                page._mouseDownHandler
                            );
                            delete page._mouseDownHandler;
                        }
                        if (page._touchStartHandler) {
                            page.removeEventListener(
                                "touchstart",
                                page._touchStartHandler
                            );
                            delete page._touchStartHandler;
                        }
                    });

                    document.removeEventListener("mousemove", this.boundOnDrag);
                    document.removeEventListener("mouseup", this.boundEndDrag);

                    if (this.isTouchDevice) {
                        if (this.boundTouchMoveHandler) {
                            document.removeEventListener(
                                "touchmove",
                                this.boundTouchMoveHandler
                            );
                            delete this.boundTouchMoveHandler;
                        }
                        document.removeEventListener(
                            "touchend",
                            this.boundEndDrag
                        );
                    }

                    this.removeDesktopPageClicks();
                }

                setupMobileEvents() {
                    this.removeMobileEvents();

                    // Add touch and click events for mobile pages
                    this.pages.forEach((page, index) => {
                        const mobileClickHandler = (e) => {
                            e.preventDefault();
                            if (index === this.mobileCurrentPageIndex) {
                                // Only respond to clicks on the active page
                                this.nextPage();
                            }
                        };

                        const mobileTouchHandler = (e) => {
                            e.preventDefault();
                            if (index === this.mobileCurrentPageIndex) {
                                // Only respond to touches on the active page
                                this.nextPage();
                            }
                        };

                        page.addEventListener("click", mobileClickHandler);
                        if (this.isTouchDevice) {
                            page.addEventListener(
                                "touchend",
                                mobileTouchHandler,
                                {
                                    passive: false,
                                }
                            );
                        }

                        // Store handlers for cleanup
                        page._mobileClickHandler = mobileClickHandler;
                        page._mobileTouchHandler = mobileTouchHandler;
                    });
                }

                removeMobileEvents() {
                    this.pages.forEach((page) => {
                        if (page._mobileClickHandler) {
                            page.removeEventListener(
                                "click",
                                page._mobileClickHandler
                            );
                            delete page._mobileClickHandler;
                        }
                        if (page._mobileTouchHandler) {
                            page.removeEventListener(
                                "touchend",
                                page._mobileTouchHandler
                            );
                            delete page._mobileTouchHandler;
                        }
                    });
                }

                setupDesktopPageClicks() {
                    this.removeDesktopPageClicks();
                    this.pages.forEach((page, index) => {
                        const clickHandler = () => {
                            if (!this.isDragging && !this.justFinishedDrag) {
                                this.flipPage(index);
                            }
                        };

                        const touchHandler = (e) => {
                            e.preventDefault();
                            if (!this.isDragging && !this.justFinishedDrag) {
                                this.flipPage(index);
                            }
                        };

                        // Add both click and touch handlers
                        page.addEventListener("click", clickHandler);
                        if (this.isTouchDevice) {
                            page.addEventListener("touchend", touchHandler, {
                                passive: false,
                            });
                        }

                        // Store handlers for cleanup
                        this.desktopClickHandlers[index] = {
                            click: clickHandler,
                            touch: touchHandler,
                        };
                    });
                }

                removeDesktopPageClicks() {
                    this.pages.forEach((page, index) => {
                        const handlers = this.desktopClickHandlers[index];
                        if (handlers) {
                            page.removeEventListener("click", handlers.click);
                            if (handlers.touch) {
                                page.removeEventListener(
                                    "touchend",
                                    handlers.touch
                                );
                            }
                        }
                    });
                    this.desktopClickHandlers = [];
                }

                nextPage() {
                    if (this.isMobile) {
                        this.nextMobilePage();
                    } else {
                        this.nextDesktopPage();
                    }
                }

                previousPage() {
                    if (this.isMobile) {
                        this.prevMobilePage();
                    } else {
                        this.prevDesktopPage();
                    }
                }

                nextMobilePage() {
                    const currentPage = this.pages[this.mobileCurrentPageIndex];

                    if (!this.mobileShowingBack) {
                        // First click: flip to show back of current page
                        this.mobileShowingBack = true;
                        currentPage.classList.remove("mobile-flip-front");
                        currentPage.classList.add("mobile-flip-back");
                    } else {
                        // Second click: slide to next page
                        if (this.mobileCurrentPageIndex < this.totalPages - 1) {
                            const nextPage =
                                this.pages[this.mobileCurrentPageIndex + 1];

                            // Slide current page left
                            currentPage.classList.remove("mobile-active");
                            currentPage.classList.add("mobile-left");

                            // Bring next page from right
                            nextPage.classList.remove("mobile-right");
                            nextPage.classList.add(
                                "mobile-active",
                                "mobile-flip-front"
                            );

                            this.mobileCurrentPageIndex++;
                            this.mobileShowingBack = false;
                        }
                    }

                    this.updateMobileIndicator();
                    this.updateMobileZIndices();
                    this.updateControls();
                }

                prevMobilePage() {
                    const currentPage = this.pages[this.mobileCurrentPageIndex];

                    if (this.mobileShowingBack) {
                        // Flip back to front of current page
                        this.mobileShowingBack = false;
                        currentPage.classList.remove("mobile-flip-back");
                        currentPage.classList.add("mobile-flip-front");
                    } else {
                        // Go to previous page
                        if (this.mobileCurrentPageIndex > 0) {
                            const prevPage =
                                this.pages[this.mobileCurrentPageIndex - 1];

                            // Slide current page right
                            currentPage.classList.remove("mobile-active");
                            currentPage.classList.add("mobile-right");

                            // Bring previous page from left, show its back
                            prevPage.classList.remove("mobile-left");
                            prevPage.classList.add(
                                "mobile-active",
                                "mobile-flip-back"
                            );

                            this.mobileCurrentPageIndex--;
                            this.mobileShowingBack = true;
                        }
                    }

                    this.updateMobileIndicator();
                    this.updateMobileZIndices();
                    this.updateControls();
                }

                // Desktop dragging methods
                startDrag(event, pageIndex) {
                    if (this.isMobile || pageIndex >= this.totalPages) return;

                    const page = this.pages[pageIndex];
                    this.isDragging = false;
                    this.justFinishedDrag = false;
                    this.dragStartX = event.clientX || event.pageX;
                    this.currentDragPage = pageIndex;
                    this.dragPage = page;
                    this.dragDirection = null;

                    page.style.cursor = "grabbing";
                }

                drag(event) {
                    if (this.isMobile || this.currentDragPage === undefined)
                        return;

                    const currentX = event.clientX || event.pageX;
                    const deltaX = currentX - this.dragStartX;

                    if (Math.abs(deltaX) > 10 && !this.isDragging) {
                        this.isDragging = true;
                        this.dragPage.classList.add("dragging");
                        this.dragDirection = deltaX > 0 ? "right" : "left";
                        this.updateZIndices();
                    }

                    if (this.isDragging) {
                        const page = this.dragPage;
                        const isFlipped = page.classList.contains("flipped");

                        if (this.dragDirection === "left" && !isFlipped) {
                            const angle = Math.max(-180, (deltaX / 200) * 180);
                            page.style.transform = `rotateY(${angle}deg)`;
                        } else if (
                            this.dragDirection === "right" &&
                            isFlipped
                        ) {
                            const angle = Math.min(
                                0,
                                -180 + (deltaX / 200) * 180
                            );
                            page.style.transform = `rotateY(${angle}deg)`;
                        }
                    }
                }

                endDrag() {
                    if (this.isMobile || this.currentDragPage === undefined)
                        return;

                    const page = this.dragPage;
                    page.style.cursor = "grab";

                    if (this.isDragging) {
                        this.justFinishedDrag = true;
                        setTimeout(() => (this.justFinishedDrag = false), 100);

                        const currentTransform = page.style.transform;
                        const angle = this.extractAngle(currentTransform);
                        const isFlipped = page.classList.contains("flipped");

                        if (
                            this.dragDirection === "left" &&
                            !isFlipped &&
                            angle < -this.dragThreshold
                        ) {
                            this.flipPageForward(this.currentDragPage);
                        } else if (
                            this.dragDirection === "right" &&
                            isFlipped &&
                            angle > -180 + this.dragThreshold
                        ) {
                            this.flipPageBackward(this.currentDragPage);
                        } else {
                            // Snap back
                            page.classList.remove("dragging");
                            page.style.transform = isFlipped
                                ? "rotateY(-180deg)"
                                : "rotateY(0deg)";
                            setTimeout(() => {
                                if (
                                    (isFlipped &&
                                        page.classList.contains("flipped")) ||
                                    (!isFlipped &&
                                        !page.classList.contains("flipped"))
                                ) {
                                    page.style.transform = "";
                                }
                            }, 600);
                        }
                    }

                    this.isDragging = false;
                    this.currentDragPage = undefined;
                    this.dragPage = null;
                    this.updateZIndices();
                }

                extractAngle(transform) {
                    const match = transform.match(/rotateY\(([^)]+)deg\)/);
                    return match ? parseFloat(match[1]) : 0;
                }

                flipPage(pageIndex) {
                    if (pageIndex >= this.totalPages) return;

                    const page = this.pages[pageIndex];
                    if (!page.classList.contains("flipped")) {
                        this.flipPageForward(pageIndex);
                    } else {
                        this.flipPageBackward(pageIndex);
                    }
                }

                flipPageForward(pageIndex) {
                    const page = this.pages[pageIndex];
                    page.classList.remove("dragging");
                    page.style.transform = "";
                    page.classList.add("flipped");
                    this.updateDesktopState();
                    this.playFlipSound();
                }

                flipPageBackward(pageIndex) {
                    const page = this.pages[pageIndex];
                    page.classList.remove("flipped", "dragging");
                    page.style.transform = "";
                    this.updateDesktopState();
                    this.playFlipSound();
                }

                playFlipSound() {
                    const audio = document.getElementById("pageFlipSound");
                    if (audio) {
                        try {
                            audio.currentTime = 0;
                            audio.play();
                        } catch (error) {
                            console.error("Audio play error:", error);
                        }
                    }
                }

                nextDesktopPage() {
                    for (let i = 0; i < this.totalPages; i++) {
                        if (!this.pages[i].classList.contains("flipped")) {
                            this.flipPageForward(i);
                            break;
                        }
                    }
                }

                prevDesktopPage() {
                    for (let i = this.totalPages - 1; i >= 0; i--) {
                        if (this.pages[i].classList.contains("flipped")) {
                            this.flipPageBackward(i);
                            break;
                        }
                    }
                }

                updateDesktopState() {
                    this.currentPage = Array.from(this.pages).filter((p) =>
                        p.classList.contains("flipped")
                    ).length;
                    this.updateControls();
                    setTimeout(() => this.updateZIndices(), 50);
                }

                updateZIndices() {
                    if (this.isMobile) return;

                    if (this.isDragging && this.dragPage) {
                        this.dragPage.style.zIndex = this.totalPages + 10;
                    }

                    let z = this.totalPages;
                    for (let i = 0; i < this.totalPages; i++) {
                        if (this.pages[i] === this.dragPage && this.isDragging)
                            continue;

                        if (this.pages[i].classList.contains("flipped")) {
                            this.pages[i].style.zIndex = i + 1;
                        } else {
                            this.pages[i].style.zIndex = z;
                            z--;
                        }
                    }
                }

                updateMobileZIndices() {
                    // For mobile, the currently active page should be on top
                    // Pages to the left go behind, pages to the right also behind in order

                    const activeIndex = this.mobileCurrentPageIndex;

                    this.pages.forEach((page, index) => {
                        if (index === activeIndex) {
                            // Active page on top
                            page.style.zIndex = 1000;
                        } else if (index < activeIndex) {
                            // Pages to the left - lower z-index
                            page.style.zIndex = index;
                        } else {
                            // Pages to the right - higher than left pages but below active
                            page.style.zIndex = activeIndex;
                        }
                    });
                }

                reset() {
                    if (this.isMobile) {
                        this.setupMobileView();
                    } else {
                        this.setupDesktopView();
                    }
                    this.updateControls();
                }

                updateControls() {
                    if (this.isMobile) {
                        this.prevBtn.disabled = false;
                        this.nextBtn.disabled = false;
                    } else {
                        this.prevBtn.disabled = this.currentPage === 0;
                        this.nextBtn.disabled =
                            this.currentPage === this.totalPages;
                    }
                }
            }

            // Initialize when DOM is loaded
            document.addEventListener("DOMContentLoaded", () => {
                new ResponsiveFlipbook();
            });
        </script>

        <audio
            id="pageFlipSound"
            src="assets/turnpage.mp3"
            preload="auto"
        ></audio>
        <audio
            id="bookCloseSound"
            src="assets/book-close.mp3"
            preload="auto"
        ></audio>
    </body>
</html>
